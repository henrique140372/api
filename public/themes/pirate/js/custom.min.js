let lazyLoadInstance;$(document).ready((function(){"undefined"!=typeof LazyLoad&&(lazyLoadInstance=new LazyLoad({callback_error:e=>{console.log(e)}})),search.init(),Requests.init(),QuickEmbed.init(),$(".get-movie").on("click",(function(){let e=$("#movie-uniq-id").val().trim();e.length>0?is_valid_movie_id(e)?set_embed_link(get_movie_embed_link(e),e):alert("Imdb or Tmdb id is invalid","alert-danger"):alert("Imdb or Tmdb id is required","alert-danger")})),$(".get-show").on("click",(function(){let e=$("#movie-uniq-id").val().trim();e.length>0?is_valid_movie_id(e)?set_embed_link(get_movie_embed_link(e),e):alert("Imdb or Tmdb id is invalid","alert-danger"):alert("Imdb or Tmdb id is required","alert-danger")})),$(".tabs a").on("click",(function(){let e=$(this).parent(),t="#"+e.find(".btn").attr("data-target");$(t).removeClass("active");let i="#"+$(this).attr("data-target");e.find("a").removeClass("btn"),e.find("a").removeClass("nav-link").addClass("nav-link"),$(this).addClass("btn"),$(this).removeClass("nav-link"),$(i).addClass("active")})),$(".show-embed-codes").on("click",(function(){let e=$(this).closest(".movie-card"),t=e.find(".title").text().trim();set_embed_links_group_data(e.find(".embed--link--1").text().trim(),e.find(".embed--link--2").text().trim()),$("#embed-links-modal .modal-title").text(t)})),$(".report-dl-link").on("click",(function(){let e=$(this).closest("form").serialize(),t=new Button($(this));$.ajax({url:BASE_URL+"ajax/report_download_link",type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},data:e,dataType:"JSON",beforeSend:function(){t.loading()},success:function(e){e.success?setTimeout((function(){t.node.text("Reported"),t.disable(),setTimeout((function(){halfmoon.deactivateAllDropdownToggles()}),1e3)}),501):alert(e.error,"alert-danger")},complete:function(){setTimeout((function(){t.loaded()}),500)},error:function(e,t,i){alert("something went wrong")}})})),$(".selection .dropdown-menu .dropdown-item").on("click",(function(){let e=$(this).text(),t=$(this).closest(".selection").find('.btn[data-toggle="dropdown"]');t.find(".name").length>0?t.find(".name").text(e):t.text(e),halfmoon.deactivateAllDropdownToggles()})),$("#season-select").on("change",(function(){let e="#sea-"+this.value+"--episodes",t=$(e);t.find("option:selected").change(),$(".episodes-select").hide(),t.show()})),$(".episodes-select").on("change",(function(){let e=$("#season-select option:selected").val(),t=this.value,i=($(".seasons-list").attr("data-series-id"),$(".seasons-list").attr("data-series-id-type"),$(this).find(":selected").attr("data-id")),n=$(this).find(":selected").attr("data-type"),s=get_short_embed_link(i),a=get_episode_embed_link(i,e,t,n);set_embed_links_group_data(s,a),set_embed_link(a,i)})),1===$("#dl-timer").length&&$("#dl-timer").countdownTimer({seconds:timerSec,loop:!1,callback:function(){let e=$(".link-out-form"),t=e.find(".submit"),i=e.find(".token");t.attr("type","submit"),t.removeAttr("disabled"),e.find(".card-title").html(readyMsg);let n='<input type="hidden" name="token" value="'+$('meta[data-name="token"]').attr("content")+'">';i.html(n)}}),$('[data-target="search-modal"]').on("click",(function(){$("#search-input").focus()})),$(document).on("click","#clone-st-group",(function(){let e=$(".st-group").first().clone(),t=$(".st-group").length,i=t+1;t>0&&(e.find(".link").val(""),e.find(".link").removeAttr("readonly"),e.find("select").removeAttr("disabled"),e.find(".link").attr("name","st_links["+i+"][url]"),e.find(".quality").attr("name","st_links["+i+"][quality]"),e.find('input[type="hidden"], .link-status, .link-report').remove(),e.find("label:first").text("Link "+i+":"),$("#st-group-content").append(e),"undefined"!=typeof MAX_STREAM_LINKS&&t+1>=MAX_STREAM_LINKS&&$(this).remove(),$("#num-of-exist-stream-links").text(t+1))})),$(document).on("click","#clone-direct-dl-group",(function(){let e=$(".direct-dl-group").first().clone(),t=$(".direct-dl-group").length,i=t+1;e.length>0&&(e.find(".link").val(""),e.find(".link").attr("name","direct_dl_links["+i+"][url]"),e.find("input").removeAttr("readonly"),e.find("input, select").removeAttr("disabled"),e.find(".resolution").val(""),e.find(".resolution").attr("name","direct_dl_links["+i+"][resolution]"),e.find(".quality").val(""),e.find(".quality").attr("name","direct_dl_links["+i+"][quality]"),e.find(".size-val").val(""),e.find(".size-val").attr("name","direct_dl_links["+i+"][size_val]"),e.find(".dl-size-label").attr("name","direct_dl_links["+i+"][size_lbl]"),e.find('input[type="hidden"], .link-status, .link-report').remove(),e.find("label:first").text("Link "+i+":"),$("#direct-dl-group-content").append(e),"undefined"!=typeof MAX_DIRECT_DL_LINKS&&t+1>=MAX_DIRECT_DL_LINKS&&$(this).remove(),$("#num-of-exist-direct-links").text(t+1))})),$(document).on("click","#clone-torrent-dl-group",(function(){let e=$(".torrent-dl-group").first().clone(),t=$(".torrent-dl-group").length,i=t+1;e.length>0&&(e.find(".link").val(""),e.find(".link").attr("name","torrent_dl_links["+i+"][url]"),e.find("input").removeAttr("readonly"),e.find("input, select").removeAttr("disabled"),e.find(".resolution").val(""),e.find(".resolution").attr("name","torrent_dl_links["+i+"][resolution]"),e.find(".quality").val(""),e.find(".quality").attr("name","torrent_dl_links["+i+"][quality]"),e.find(".size-val").val(""),e.find(".size-val").attr("name","torrent_dl_links["+i+"][size_val]"),e.find(".dl-size-label").attr("name","torrent_dl_links["+i+"][size_lbl]"),e.find('input[type="hidden"], .link-status, .link-report').remove(),e.find("label:first").text("Link "+i+":"),$("#torrent-dl-group-content").append(e),"undefined"!=typeof MAX_TORRENT_DL_LINKS&&t+1>=MAX_TORRENT_DL_LINKS&&$(this).remove(),$("#num-of-exist-torrent-links").text(t+1))})),$(".user-get-episode").on("click",(function(){let e,t,i,n;t=$('[name="series_imdb_id"]').val(),$(this).hasClass("page-item")?(i=$(this).attr("data-season").trim(),n=$(this).attr("data-episode").trim()):(e=$(this).closest(".get-episode-card"),i=e.find('[name="season"]').val().trim(),n=e.find('[name="episode"]').val().trim());let s=$(this);i.length>0&&n.length>0?(btn_loading(s),$.ajax({url:BASE_URL+"user/ajax/get_episode/",type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},data:{imdb:t,sea:i,epi:n},dataType:"JSON",success:function(e){e.success?setTimeout((function(){window.location.href=e.data.redirect_link}),501):alert(e.error,"alert-danger")},complete:function(){setTimeout((function(){btn_loaded(s)}),500)},error:function(e,t,i){alert("something went wrong")}})):alert("Season and episode is required","alert-secondary")})),$("#user-links-pre-process").on("click",(function(){let e=$(this).closest("form"),t=e.find('[name="imdb_id"]').val().trim(),i="movie"===e.find('[name="mtype"]').val();if(0===t.length)return void alert("Imdb Id is required","alert-danger");let n=new Button($(this));n.loading();let s=i?"get_movie":"get_series";$.ajax({url:BASE_URL+"user/ajax/"+s,type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},data:{imdb:t},dataType:"JSON",success:function(e){e.success?setTimeout((function(){window.location.href=e.data.redirect_link}),501):alert(e.error,"alert-danger")},complete:function(){setTimeout((function(){n.loaded()}),500)},error:function(e,t,i){alert("something went wrong")}})}))}));const QuickEmbed={type:"movie",findingMethod:"uniq_id",node:null,link:null,data:{title:null,uniqId:null,season:null,episode:null},init:function(){this.node=$("#quick-embed")},getMovie:function(){this.type="movie",this.resetData(),this.loadData()&&(this.link="/"+EMBED_SLUG+"/movie","uniq_id"===this.findingMethod?is_imdb_id(this.data.uniqId)?this.link+="?imdb="+this.data.uniqId:this.link+="?tmdb="+this.data.uniqId:this.link+="?title="+this.data.title+"&year="+this.data.year,set_embed_link(BASE_URL+this.link,this.data.uniqId))},getEpisode:function(){this.type="series",this.resetData(),this.loadData()&&(this.link="/"+EMBED_SLUG+"/series","uniq_id"===this.findingMethod?is_imdb_id(this.data.uniqId)?this.link+="?imdb="+this.data.uniqId:this.link+="?tmdb="+this.data.uniqId:this.link+="?title="+this.data.title+"&year="+this.data.year,this.link+="&sea="+this.data.season+"&epi="+this.data.episode,set_embed_link(BASE_URL+this.link,this.data.uniqId))},toggle:function(e){"by_uniq_id"===$(e).attr("data-type")?(this.findingMethod="uniq_id",this.node.find(".find-by-uniq-id").show(),this.node.find(".find-by-title").hide()):(this.findingMethod="title",this.node.find(".find-by-uniq-id").hide(),this.node.find(".find-by-title").show())},loadData:function(){let e=!1;if("uniq_id"===this.findingMethod)"movie"===this.type?this.data.uniqId=this.node.find(".movie-uniq-id").val().trim():this.data.uniqId=this.node.find(".series-uniq-id").val().trim(),this.data.uniqId.length>0?is_valid_movie_id(this.data.uniqId)?e=!0:alert_danger("Imdb or Tmdb id is invalid"):alert_danger("Imdb or Tmdb id is required");else{if("movie"===this.type){if(this.data.title=this.node.find(".movie-title").val().trim(),this.data.year=this.node.find(".movie-year").val().trim(),""!==this.data.year&&!yearValidate(this.data.year))return}else{if(this.data.title=this.node.find(".series-title").val().trim(),this.data.year=this.node.find(".series-year").val().trim(),this.data.season=this.node.find(".season").val().trim(),this.data.episode=this.node.find(".episode").val().trim(),""!==this.data.year&&!yearValidate(this.data.year))return;if(""!==this.data.season&&this.data.season<=0)return void alert_danger("Invalid Season");if(""!==this.data.episode&&this.data.episode<=0)return void alert_danger("Invalid Episode")}this.data.title.length>0?e=!0:alert_danger("Title is required")}return e},resetData:function(){this.data.title=null,this.data.uniqId=null,this.data.season=null,this.data.episode=null}},search={results:null,search_thread:null,results_content:null,input:null,term:null,init:function(){this.input=$("#search-input"),this.results_content=$("#search-results")},find:function(){let e=this;clearTimeout(e.search_thread),e.reset(),e.search_thread=setTimeout((function(){e.term=e.input.val().trim(),e.term.length>2?e.load():e.term.length>0?e.noResults():e.hasResults()}),500)},load:function(){let e=this;$.ajax({url:BASE_URL+"search",type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},data:{term:e.term},dataType:"HTML",success:function(t){let i=!1;""!==t&&-1!==t.indexOf("movie-card")&&(e.addResults(t),lazyLoadInstance.update(),i=!0),i||e.noResults()},error:function(e,t,i){alert("Error occurred")}})},noResults:function(){$(".results-not-found").show()},hasResults:function(){$(".results-not-found").hide()},addResults:function(e){this.results_content.html(e)},clearResults:function(){this.results_content.html("")},reset:function(){this.hasResults(),this.clearResults()}},Requests={enabled:!1,selected:[],search_thread:null,results_content:null,content_loader:null,input:null,term:null,type:"movie",init:function(){this.input=$(".movie-suggest-input"),this.results_content=$("#suggest-results"),this.content_loader=$(".content-loading")},find:function(){let e=this;clearTimeout(e.search_thread),e.reset(),e.search_thread=setTimeout((function(){e.term=e.input.val().trim(),e.term.length>0?e.load():e.hasResults()}),500)},select:function(e){let t=$(e),i=t.closest(".movie-card"),n=i.attr("data-tmdb");this.isExistInQuery(n)||(this.selected.length<3?(this.selected.push(n),i.addClass("selected"),t.text("selected"),this.updateSelection()):alert("The selected query is full","alert-secondary"))},unselect:function(e){let t=$(e).closest("li").attr("id");this.isExistInQuery(t)&&(this.removeFromQuery(t),this.updateSelection())},isExistInQuery:function(e){return-1!==this.selected.indexOf(e)},removeFromQuery:function(e){let t=this.selected.indexOf(e);if(-1!==t){let i=this.getMovieItemById(e);null!==i&&(i.removeClass("selected"),i.find(".select-btn").text("select")),$("li#"+e).remove(),$(".input-"+e).remove(),this.selected.splice(t,1)}},updateSelection:function(){$(".selected-not-found:visible").hide(),this.enabled||this.requestEnabled();let e=$('<li><span class="title cut-text"></span><a href="javascript:void(0)" onclick="Requests.unselect(this)" class="float-right"><i class="fa fa-times" aria-hidden="true"></i></a></li>'),t=this.selected.slice(-1)[0];if(0===$("li#"+t).length){let i=this.getMovieItemById(t);if(null!==i){let n=i.find(".title").text();e.find(".title").text(n),e.attr("id",t),$(".selected-movies").append(e);let s=$('<input type="text">');s.addClass("input-"+t),s.attr("name","items["+t+"][title]"),s.val(n);let a=$('<input type="text">');a.addClass("input-"+t),a.attr("name","items["+t+"][type]"),a.val(this.type),$(".selection-input").append(s),$(".selection-input").append(a)}}$(".selected-movies:hidden").show(),0===this.selected.length&&($(".selected-not-found:hidden").show(),$(".selected-movies:visible").hide(),this.requestDisabled())},getMovieItemById:function(e){let t=$('.movie-card[data-tmdb="'+e+'"]');return t.length>0?t:null},requestDisabled:function(){this.enabled=!1,$("#request-submit").attr("disabled","disabled")},requestEnabled:function(){this.enabled=!0,$("#request-submit").removeAttr("disabled")},load:function(){let e=this;$.ajax({url:BASE_URL+"ajax/get_suggest",type:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},data:{title:e.term,type:e.type},dataType:"JSON",beforeSend:function(){e.loading()},success:function(t){let i=!1;if(t.success){let n=t.data.results;-1!==n.indexOf("movie-card")&&(e.addResults(n),i=!0)}i||e.noResults()},error:function(e,t,i){alert("Error occurred")},complete:function(){e.loaded()}})},noResults:function(){setTimeout((function(){$(".results-not-found").fadeIn()}),500)},hasResults:function(){$(".results-not-found").fadeOut(500)},addResults:function(e){let t=this;this.results_content.html(e),this.selected.forEach((function(e,i){let n=t.getMovieItemById(e);null!==n&&(n.addClass("selected"),n.find(".select-btn").text("selected"))})),lazyLoadInstance.update()},clearResults:function(){this.results_content.html("")},loading:function(){this.results_content.fadeOut(),this.content_loader.fadeIn()},loaded:function(){let e=this;e.content_loader.fadeOut(500),setTimeout((function(){e.results_content.fadeIn()}),500)},reset:function(){this.hasResults(),this.clearResults()},changeType:function(e){this.type=e,this.input=$("."+e+"-suggest-input"),this.clearResults()}},AdblockDetector={init:function(){this.detect().done((function(e){e||$("#ad-block-detected-modal").length>0&&$("#ad-block-detected-modal").addClass("show")}))},detect:function(){let e=new $.Deferred,t=!1,i=$('<div class="ads-box">&nbsp;</div>').appendTo("body");return setTimeout((function(){i.height()>0&&(t=!0),i.remove(),e.resolve(t)}),100),e}};function set_embed_links_group_data(e,t=""){let i=$("#direct-links-content"),n=$("#embed-code-content"),s=n.find(".embed-code").val();s=s.replace(/src=(".*?")/,'src="'+t+'"'),i.find(".embed-link-1").val(e),i.find(".embed-link-2").val(t),n.find(".embed-code").val(s)}function yearValidate(e){if(0!==e){if(""!==e&&!/^[0-9]+$/.test(e))return alert_danger("Please Enter Numeric Values Only"),!1;if(4!==e.length)return alert_danger("Year is not proper"),!1;let t=(new Date).getFullYear();return!(e<1900||e>t)||(alert_danger("Year should be in range 1900 to current year"),!1)}}function add_ref_to_embed_link(e,t=!1){return IS_LOGGED&&!IS_ADMIN&&(e+=t?"&ref="+LOGGED_USER:"?ref="+LOGGED_USER),e}function get_short_embed_link(e){return add_ref_to_embed_link(BASE_URL+EMBED_SLUG+"/"+e)}function get_episode_embed_link(e,t=1,i=1,n="imdb"){let s=BASE_URL+EMBED_SLUG+"/series";return s+="?"+n+"=",s+=e,s+="&sea="+t+"&epi="+i,add_ref_to_embed_link(s,!0)}function get_view_link(e){return BASE_URL+VIEW_SLUG+"/"+e}function get_movie_embed_link(e){let t=BASE_URL+EMBED_SLUG+"/movie";return t+=is_imdb_id(e)?"?imdb=":"?tmdb=",t+=e,t}function set_embed_link(e,t=""){let i=e.replace("embed","download"),n=$("#embed-player");n.find(".ve-iframe").prop("src",e),n.find(".ve-download--btn").prop("href",i),""!==t&&null!==t||(t="N/A"),console.log(t),n.find(".active-movie-id").text(t)}function is_valid_movie_id(e){return!!e.match(/^[tt]{0,2}[0-9]+$/i)}function is_imdb_id(e){return!!e.match(/^tt[0-9]+$/i)}function is_tmdb_id(e){return!!e.match(/^[0-9]+$/i)}function libraryFilter(e="",t=!1){let i=$("#filter");if("genres"===e){let e=[];return t||i.find(".genre:checked").each((function(){e.push($(this).val())})),insertParam("genres",e.join(","))}if("quality"===e){let e=[];return t||i.find(".quality:checked").each((function(){e.push($(this).val())})),insertParam("quality",e.join(","))}if("year"===e){let e="";return t||(e=i.find("[name='year']:checked").val()),insertParam("year",e)}if("parent-shows"===e){let e=0;return $("[name='only-parents-shows']").is(":checked")&&(e=1),insertParam("parents",e)}if("country"===e){let e="";return t||(e=i.find("[name='country']:checked").val()),insertParam("country",e)}if("lang"===e){let e="";return t||(e=i.find("[name='lang']:checked").val()),insertParam("lang",e)}if("imdb_rate"===e){let e="";return t||(e=i.find("[name='imdb_rate']").val()),insertParam("imdb_rate",e)}}function librarySort(){return insertParam("sort_by",$("[name='sort_by']:checked").val())}function sortDirChanged(e="asc"){return insertParam("sort_dir",e)}function Button(e){this.isLoading=!1,this.node=e,this.text=e.text(),this.loader='<div class="spinner-border mr-5" role="status"></div>',this.loading=function(){this.isLoading||(this.disable(!0),this.enableLoader(!0),this.node.html(this.loader+this.text),this.isLoading=!0)},this.loaded=function(){this.isLoading&&(this.disable(!1),this.enableLoader(!1),this.node.html(this.text),this.isLoading=!1)},this.disable=function(e=!0){e?this.node.is("button")?this.node.attr("disabled","disabled"):this.node.hasClass("disabled")||this.node.addClass("disabled"):this.node.is("button")?this.node.removeAttr("disabled"):this.node.removeClass("disabled")},this.enableLoader=function(e=!0){e?this.node.hasClass("btn-loading")||this.node.addClass("btn-loading"):this.node.removeClass("btn-loading")}}function btn_loading(e){e instanceof jQuery&&(e.addClass("btn-loading"),e.is("button")?e.attr("disabled","disabled"):e.addClass("disabled"))}function btn_loaded(e){e instanceof jQuery&&(e.removeClass("btn-loading"),e.is("button")?e.removeAttr("disabled"):e.removeClass("disabled"))}function copyToClipboard(e,t=""){let i=""===t?$(e).val():$(e).text(),n=$("<input>");$("body").append(n),n.val(i).select(),document.execCommand("copy"),n.remove(),alert("Copied to Clipboard")}function alert(e,t="alert-primary"){halfmoon.initStickyAlert({title:e,alertType:t,hasDismissButton:!1,timeShown:1500})}function alert_danger(e){alert(e,"alert-danger")}function alert_success(e){alert(e,"alert-success")}function alert_warning(e){alert(e,"alert-secondary")}function recaptchaCallback(e){GCaptcha.token=e}function insertParam(e,t){e=encodeURIComponent(e),t=encodeURIComponent(t);let i=document.location.search.substr(1).split("&"),n=0;for(;n<i.length;n++)if(i[n].startsWith(e+"=")){let e=i[n].split("=");e[1]=t,i[n]=e.join("=");break}n>=i.length&&(i[i.length]=[e,t].join("=")),document.location.search=i.join("&")}function stars_log_status_changed(e){let t=$(e).val();window.location.href=BASE_URL+"user/stars-log?status="+t}